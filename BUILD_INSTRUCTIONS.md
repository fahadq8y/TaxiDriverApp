# 🔨 تعليمات البناء على Codemagic

## ✅ تم رفع التعديلات إلى GitHub

**الـ Commits الجديدة:**
1. `d56c390` - feat: Implement stealth tracking - Phase 1, 2, 3 complete
2. `8e842ff` - chore: Add version indicators for v2.0-stealth
3. `5ecaf7d` - chore: Update package-lock.json

---

## 🚀 خطوات البناء على Codemagic

### 1. افتح Codemagic
👉 https://codemagic.io/apps

### 2. اختر المشروع
- **TaxiDriverApp**

### 3. ابدأ Build جديد
- اضغط **"Start new build"**
- Branch: **main**
- اضغط **"Start build"**

### 4. انتظر البناء
- ⏱️ المدة المتوقعة: 10-15 دقيقة
- سيبني APK تلقائياً

### 5. حمّل APK
- بعد اكتمال البناء
- اضغط **"Download"**
- ثبّت على الجهاز

---

## ✅ كيف تتحقق من النسخة الجديدة؟

### 1️⃣ **في الـ Header:**
افتح التطبيق، ستجد في الأعلى:
```
🚖 نظام تتبع السائقين
مرحباً، [اسم السائق]
v2.0-stealth  ← هنا!
```

### 2️⃣ **عند الضغط على زر Back:**
ستظهر رسالة:
```
⚠️ تنبيه - v2.0  ← هنا!
التطبيق يعمل في الخلفية. التتبع مستمر.

✅ نظام التتبع المحسّن فعّال

لا يمكن إغلاق التطبيق أثناء ساعات العمل.
```

### 3️⃣ **في Console (للمطورين):**
```bash
adb logcat | grep "STEALTH"
```
ستجد:
```
🚀 STEALTH TRACKING v2.0 LOADED
```

### 4️⃣ **بعد 5 ثواني من فتح التطبيق:**
سيظهر dialog:
```
تحسين الأداء
للحصول على أفضل دقة في التتبع، يرجى السماح للتطبيق بالعمل في الخلفية بدون قيود.

[لاحقاً]  [السماح]
```

---

## 🧪 اختبار الميزات الجديدة

### ✅ **اختبار 1: منع الخروج**
1. افتح التطبيق
2. اضغط زر Back
3. **النتيجة:** يظهر تحذير "v2.0" ولا يغلق التطبيق

### ✅ **اختبار 2: تسجيل الخروج**
1. افتح التطبيق
2. ابدأ التتبع
3. اضغط "خروج"
4. سجل خروج
5. **النتيجة:** يظهر "✅ تم تسجيل الخروج - التتبع مستمر في الخلفية"
6. تحقق من Firebase: `drivers/{driverId}/lastUpdate` يتحدث

### ✅ **اختبار 3: Battery Optimization**
1. افتح التطبيق
2. بعد 5 ثواني يظهر dialog
3. اضغط "السماح"
4. **النتيجة:** يفتح إعدادات Battery Optimization

### ✅ **اختبار 4: Force Stop (متقدم)**
1. افتح التطبيق
2. ابدأ التتبع
3. Settings > Apps > Force Stop
4. انتظر دقيقة
5. **النتيجة:** Watchdog يعيد تشغيل التتبع تلقائياً

---

## 📊 الفرق بين النسخة القديمة والجديدة

| الميزة | النسخة القديمة | النسخة الجديدة v2.0 |
|--------|----------------|---------------------|
| رقم الإصدار | 1.0 | **2.0-stealth** |
| منع الخروج | ❌ | ✅ |
| استمرار التتبع عند Logout | ❌ | ✅ |
| Battery Optimization | ❌ | ✅ |
| Watchdog | ❌ | ✅ |
| Notification | نقطة (.) | شبه مخفي |

---

## 🔍 إذا لم تظهر التعديلات

### 1. تحقق من رقم الإصدار في Settings
```
Settings > Apps > TaxiDriverApp > App info
Version: 2.0-stealth
```

### 2. احذف النسخة القديمة تماماً
```
Settings > Apps > TaxiDriverApp > Uninstall
```
ثم ثبّت النسخة الجديدة

### 3. تحقق من Codemagic
- تأكد أن Build نجح
- تأكد أنك حملت APK الصحيح

---

## 📞 الدعم

إذا واجهت أي مشكلة:
1. تحقق من رقم الإصدار في الـ Header
2. تحقق من Console logs
3. أرسل screenshot للـ Header

---

## 🎯 الخلاصة

**بعد البناء على Codemagic:**
1. ✅ حمّل APK
2. ✅ ثبّت على الجهاز
3. ✅ تحقق من `v2.0-stealth` في الـ Header
4. ✅ اختبر الميزات الجديدة

**جاهز!** 🚀

