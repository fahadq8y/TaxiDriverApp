# ๐ ุงููุฑุฌุน ุงูุฑุฆูุณู ููุดุฑูุน Taxi Driver App

> **ุขุฎุฑ ุชุญุฏูุซ:** 24 ุฃูุชูุจุฑ 2025  
> **ุงููุฏู:** ุชูุซูู ุดุงูู ูุฌููุน ุงูุชุบููุฑุงุชุ ุงูููุงุนุฏุ ุงููุดุงููุ ูุงูุญููู ูุชุฌูุจ ุชูุฑุงุฑ ุงูุฃุฎุทุงุก

---

## ๐ฏ ุงูููุงุนุฏ ุงูุฐูุจูุฉ (ูุฌุจ ุนุฏู ุชุบููุฑูุง ุฃุจุฏุงู)

### 1. ูุนุฑูุงุช ุงูุณุงุฆููู (Driver IDs)

**ุงููุงุนุฏุฉ ุงูุซุงุจุชุฉ:**
- ุงูุฑูู ุงููุธููู ุงูุฑุณูู: `DRV001`, `DRV002`, ... ุฅูุฎ
- ูุชู ุฅูุดุงุก ุงูุฑูู ุงููุธููู **ุชููุงุฆูุงู** ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุณุงุฆููู
- ุงูุณุงุฆู **ูุง ููุชุจ** ุฑููู ุงููุธููู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุงูุณุงุฆู ููุชุจ **ุงุณูู** ู **ูููุฉ ุงููุฑูุฑ** ููุท

**ุงูุจูุงูุงุช ูู Firestore:**

```
Collection: users
Document ID: (auto-generated)
Fields:
  - name: "ุณุงุฆู 1"
  - password: "123"
  - driverId: "DRV001"  โ ูุฐุง ูู ุงูุฑูู ุงููุธููู ุงูุฑุณูู
  - role: "driver"
```

```
Collection: drivers
Document ID: "DRV001"  โ ููุณ ุงูุฑูู ุงููุธููู
Fields:
  - driverId: "DRV001"
  - employeeNumber: "DRV001"
  - name: "ุณุงุฆู 1"
  - isActive: true/false
  - location: { latitude, longitude, speed, accuracy, heading }
  - lastUpdate: timestamp
```

**โ๏ธ ุชูุจูู ููู:**
- **ูุง ุชุณุชุฎุฏู** ุฃุฑูุงู ุจุณูุทุฉ ูุซู `1`, `2`, `3` ููุนุฑูุงุช ููุณุงุฆููู
- **ูุง ุชุฎูุท** ุจูู `DRV001` ู `1` - ุงุณุชุฎุฏู ุฏุงุฆูุงู ุงูุตูุบุฉ ุงููุงููุฉ
- **ูุง ุชุบูุฑ** ูุนุฑู ุงููุซููุฉ ูู collection `drivers` - ูุฌุจ ุฃู ูููู ุฏุงุฆูุงู `DRV001`

---

## ๐ฆ Collections ูู Firestore

### Collection: `drivers`

**ุงูุบุฑุถ:** ุชุฎุฒูู ุจูุงูุงุช ุงูุณุงุฆููู ููููุนูู ุงูุญุงูู

**Document ID:** ุงูุฑูู ุงููุธููู (ูุซู `DRV001`)

**ุงูุญููู ุงููููุฉ:**
- `isActive` (Boolean): ุญุงูุฉ ุงูุชุชุจุน (true = ูุดุทุ false = ุบูุฑ ูุดุท)
- `location` (Map): ุงููููุน ุงูุญุงูู
  - `latitude` (Number)
  - `longitude` (Number)
  - `speed` (Number)
  - `accuracy` (Number)
  - `heading` (Number)
- `lastUpdate` (Timestamp): ุขุฎุฑ ุชุญุฏูุซ

**โ๏ธ ูุงุนุฏุฉ ูููุฉ:**
- **ุฌููุน ุตูุญุงุช ุงูุชุชุจุน** ูุฌุจ ุฃู ุชูุฑุฃ ูู `drivers` collection ููุท
- **ูุง ุชุณุชุฎุฏู** `driverLocations` collection (ูุฏูู ููููู)

---

### Collection: `users`

**ุงูุบุฑุถ:** ุชุฎุฒูู ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู ูููุณุชุฎุฏููู

**ุงูุญููู ุงููููุฉ:**
- `name` (String): ุงุณู ุงููุณุชุฎุฏู
- `password` (String): ูููุฉ ุงููุฑูุฑ
- `driverId` (String): ุงูุฑูู ุงููุธููู (ููุณุงุฆููู ููุท)
- `role` (String): "driver" ุฃู "admin"

---

## ๐ ุณุฌู ุงูุชุบููุฑุงุช

### ุงูุชุบููุฑ #1: ุฅุตูุงุญ ุชุนุงุฑุถุงุช Google Play Services
**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** `IncompatibleClassChangeError` ุจุณุจุจ ุชุนุงุฑุถ ุฅุตุฏุงุฑุงุช Google Play Services  
**ุงูุญู:**
- ุชุญุฏูุซ `android/build.gradle`:
  ```gradle
  ext {
      playServicesLocationVersion = "21.3.0"
  }
  ```
- ุฅุฒุงูุฉ ุงูุชุจุนูุงุช ุงููุฏููุฉ ูู `android/app/build.gradle`
- ุงูุณูุงุญ ูููุชุจุฉ Transistor ุจุฅุฏุงุฑุฉ ุงูุชุจุนูุงุช ุชููุงุฆูุงู

**Commit:** `0f2bdc0`

---

### ุงูุชุบููุฑ #2: ุฅุตูุงุญ ุตูุญุฉ ุงูุชุชุจุน ุงูุชุฌุฑูุจูุฉ ูู ุงูุชุทุจูู
**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ุงุณุชุฎุฏุงู ูุนุฑู ุซุงุจุช `DRV001` ุจุฏูุงู ูู ุงูุฑูู ุงููุธููู ุงููุนูู  
**ุงูุญู:**
- ุชุนุฏูู `TestTrackingScreen.js` ููุฑุงุกุฉ `employeeNumber` ูู AsyncStorage
- ุงุณุชุฎุฏุงู `employeeNumber` ุงูุฏููุงูููู ุจุฏูุงู ูู ุงููููุฉ ุงูุซุงุจุชุฉ

**Commit:** `95828ec`

---

### ุงูุชุบููุฑ #3: ุฅุตูุงุญ ุตูุญุงุช ุงูุชุชุจุน ูู ุงููููุน
**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ุงูุตูุญุงุช ุชูุฑุฃ ูู `driverLocations` ุจุฏูุงู ูู `drivers`  
**ุงูุญู:**
- ุชุนุฏูู `test-tracking.html`: ุงุณุชุฎุฏุงู `driverId` ูู URL query parameter
- ุชุนุฏูู `tracking-management.html`: ุงููุฑุงุกุฉ ูู `drivers` + ุงุณุชูุงุน ูู ุงูููุช ุงููุนูู
- ุชุนุฏูู `tracking.html`: ุงููุฑุงุกุฉ ูู `drivers` + ุงุณุชุฎุฏุงู `isActive`

**Commit:** `39e13c1`

---

### ุงูุชุบููุฑ #4: ุฅุถุงูุฉ logging ุชูุตููู ููุชุชุจุน ุงูุชููุงุฆู
**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ุงูุชุชุจุน ุงูุชููุงุฆู ูุง ูุนูู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู  
**ุงูุญู:**
- ุฅุถุงูุฉ logging ุชูุตููู ูู `MainScreen.js`
- ุฅุถุงูุฉ ุฑุณุงุฆู Alert ูุชูุถูุญ ุงูุฃุฎุทุงุก

**Commit:** `cc0cb3b`

---

### ุงูุชุบููุฑ #5: ุฅุถุงูุฉ Alert ูุชุชุจุน ุนูููุงุช ุงููุชุงุจุฉ ุฅูู Firestore
**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ุงูุชุทุจูู ูุง ููุชุจ ุฅูู Firestore ุฑุบู ุฃู ุงูุชุชุจุน ูุดุท  
**ุงูุญู:**
- ุฅุถุงูุฉ Alert ูู `LocationService.js` ูุจู ูุจุนุฏ ุงููุชุงุจุฉ ุฅูู Firestore
- ุฅุถุงูุฉ Alert ุนูุฏ ุญุฏูุซ ุฎุทุฃ ูู ุงููุชุงุจุฉ
- ูุฐุง ููุชุดุฎูุต ููุท - ุณูุชู ุฅุฒุงูุชู ุจุนุฏ ุญู ุงููุดููุฉ

**Commit:** `64ea8e0`

---

### ุงูุชุบููุฑ #6: ุฅุตูุงุญ ุฎุทุฃ missing Alert import
**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ุงูุชุทุจูู ูุชุนุทู ุนูุฏ ุจุฏุก ุงูุชุชุจุน - `Property 'Alert' doesn't exist`  
**ุงูุณุจุจ:** ูุณูุช ุฅุถุงูุฉ `import { Alert }` ูู commit ุงูุณุงุจู  
**ุงูุญู:**
- ุฅุถุงูุฉ `import { Alert, Platform, PermissionsAndroid } from 'react-native';`
- ุฅุฒุงูุฉ ุงูุณุทุฑ ุงูููุฑุฑ

**Commit:** `0b8111a`

---

### ุงูุชุบููุฑ #7: ุฅุตูุงุญ ูุดููุฉ serverTimestamp() - ุฑุญูุฉ ุทูููุฉ ูู ุงูุชุฌุฑุจุฉ ูุงูุฎุทุฃ

**ุงูุชุงุฑูุฎ:** 24 ุฃูุชูุจุฑ 2025  
**ุงูููุช:** 1:00 PM - 3:00 PM (GMT+3)  

---

#### ุงููุฑุญูุฉ 1: ุงูุชุดุงู ุงููุดููุฉ

**ุงูุฎุทุฃ ุงูุธุงูุฑ:**
```
u.default.FieldValue.serverTimestamp is not a function (it is undefined)
```

**ุงูุฃุนุฑุงุถ:**
- ุงูุชุทุจูู ูุธูุฑ ุงูุชุชุจุน ูุดุทุงู (ุงูุดุฑูุท ุงูุฃุฎุถุฑ + ุงูุฅุดุนุงุฑ)
- ููู ุงูุจูุงูุงุช **ูุง ุชููุชุจ** ุฅูู Firestore
- `lastUpdate` ูู Firestore ุนุงูู ุนูุฏ 23 ุฃูุชูุจุฑ 20:43 UTC

**ุงูุณุจุจ ุงูููุชุดู:**
ุงูููุฏ ุงูุญุงูู ูุณุชุฎุฏู:
```javascript
firestore.FieldValue.serverTimestamp()  // โ ุฎุงุทุฆ
```

**ุงูุชุญููู:**
- ุนูุฏ ุงุณุชูุฑุงุฏ `firestore` ูู `@react-native-firebase/firestore`ุ ูุฅู `firestore` ูู **ุฏุงูุฉ** ูููุณ ูุงุฆู
- ูุฌุจ ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ `firestore()` ุฃููุงู ููุญุตูู ุนูู instance
- ุซู ุงููุตูู ุฅูู `FieldValue` ูู ูุฐุง ุงูู instance

---

#### ุงููุฑุญูุฉ 2: ุงููุญุงููุฉ ุงูุฃููู - ุฅุถุงูุฉ ุงูุฃููุงุณ

**ุงูุญู ุงูููุชุฑุญ:**
```javascript
firestore().FieldValue.serverTimestamp()  // โ ุตุญูุญ ูุธุฑูุงู
```

**ุงูุชุนุฏููุงุช:**
- ุงูุณุทุฑ 181: ูู ุฏุงูุฉ `start()`
- ุงูุณุทุฑ 251: ูู ุฏุงูุฉ `onLocation()`
- ุงูุณุทุฑ 277: ูู ุฏุงูุฉ `updateDriverStatus()`

**Commit:** `f649d6d` - "Fix: Correct serverTimestamp() usage - add parentheses after firestore"

**ุงููุชูุฌุฉ:**
- ุชู ุฑูุน ุงูููุฏ ุฅูู GitHub โ
- ุชู ุฅุนุงุฏุฉ ุงูุจูุงุก ุนูู CodeMagic โ
- **ููู ุงูุฎุทุฃ ูุงุฒุงู ูุธูุฑ!** โ

---

#### ุงููุฑุญูุฉ 3: ุงูุชุญููู ูุงูุชุญููู ุงูุนููู

**ุงูุฎุทุฃ ุงูุฌุฏูุฏ:**
```
Cannot read property 'serverTimestamp' of undefined
```

**ุงูููุงุญุธุงุช:**
1. ุงูุจูุงุก ูู commit `384e8f4` (ุงูุชูุซูู ููุท)
2. ุงูููุฏ ุนูู GitHub ุตุญูุญ โ
3. ููู ุงูุฎุทุฃ ูููู `FieldValue` ููุณู `undefined`!

**ุงูุจูุฆุฉ ุงูููุชุดูุฉ:**
```json
{
  "@react-native-firebase/firestore": "^23.4.1",
  "react": "19.1.1",
  "react-native": "0.82.0"
}
```

**ุงูุชุถุงุฑุจ ุงููุญุชูู:**
- React Native Firebase **v23.4.1** (ุฃุญุฏุซ ุฅุตุฏุงุฑ)
- React **19.1.1** (React 19 - ุฅุตุฏุงุฑ ุฌุฏูุฏ ุฌุฏุงู)
- ูุฏ ุชููู ููุงู ูุดููุฉ ุชูุงูู ุจูู ุงูุฅุตุฏุงุฑุงุช

---

#### ุงููุฑุญูุฉ 4: ุงูุญู ุงูุจุฏูู ุงููุคูุช

**ุงููุฑุงุฑ:**
ุงุณุชุจุฏุงู `serverTimestamp()` ุจู `new Date()` ูุคูุชุงู

**ุงูุชุนุฏูู:**
```javascript
// ูุจู
lastUpdate: firestore().FieldValue.serverTimestamp()

// ุจุนุฏ
lastUpdate: new Date()
```

**ุงููุฒุงูุง:**
- โ ูุนูู ุจุฏูู ุฃุฎุทุงุก
- โ ูุญูุธ ุงูููุช ุงูุญุงูู
- โ ูุชูุงูู ูุน ุฌููุน ุงูุฅุตุฏุงุฑุงุช
- โ ุจุณูุท ููุจุงุดุฑ

**ุงูุนููุจ:**
- โ๏ธ ูุณุชุฎุฏู ููุช ุงูุฌูุงุฒ (Client) ูููุณ ุงูุณูุฑูุฑ
- โ๏ธ ูุฏ ูููู ุบูุฑ ุฏููู ุฅุฐุง ูุงู ููุช ุงูุฌูุงุฒ ุฎุงุทุฆ
- โ๏ธ ูุดุงูู ูุญุชููุฉ ูุน ุงูููุงุทู ุงูุฒูููุฉ ุงููุฎุชููุฉ

**Commit:** `830d783` - "Temp fix: Use new Date() instead of serverTimestamp()"

---

#### ุงูุฎูุงุตุฉ

**ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:**
- ุฎุทุฃ ูู ุงุณุชุฎุฏุงู `serverTimestamp()` ูู React Native Firebase v23
- ูุญุงููุฉ ุฅุตูุงุญ ุจุฅุถุงูุฉ ุงูุฃููุงุณ ูู ุชูุฌุญ
- ุชุถุงุฑุจ ูุญุชูู ูุน React 19 ุฃู Firebase v23

**ุงูุญู ุงูููุงุฆู:**
- ุงุณุชุจุฏุงู `serverTimestamp()` ุจู `new Date()`
- ุญู ูุคูุช ูููู ูุนูู ุจุดูู ุฌูุฏ
- ูููู ุงูุจุญุซ ุนู ุญู ุฏุงุฆู ูุงุญูุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ

**Commits:**
- `f649d6d`: ุงููุญุงููุฉ ุงูุฃููู (ูู ุชูุฌุญ)
- `384e8f4`: ุงูุชูุซูู
- `830d783`: ุงูุญู ุงูุจุฏูู (ูุนูู โ)
- `4fb2f96`: ุชุญุฏูุซ ุงูุชูุซูู

---

## โ ุงููุดุงูู ุงููุนุฑููุฉ

### ูุดููุฉ #1: ุงูุชุชุจุน ูุง ููุชุจ ุฅูู Firestore
**ุงูุญุงูุฉ:** โ **ุชู ุงูุญู (ุจุญู ุจุฏูู)**  
**ุงูุณุจุจ ุงูุฃุณุงุณู:** ุฎุทุฃ ูู ุงุณุชุฎุฏุงู `serverTimestamp()` + ุชุถุงุฑุจ ูุญุชูู ูุน React Native Firebase v23  
**ุงูุญู:** ุงุณุชุจุฏุงู `serverTimestamp()` ุจู `new Date()` - ุงูุธุฑ ุงูุชุบููุฑ #7

---

### ูุดููุฉ #2: ุตูุญุฉ ูุนูููุงุช ุงูุณุงุฆู ูุงุฑุบุฉ
**ุงูุญุงูุฉ:** ููุฏ ุงูุชุญููู  
**ุงูุณุจุจ ุงููุญุชูู:** ูุดููุฉ ูู Firebase ูู WebView  
**ุงูุญู ุงูููุชุฑุญ:** ุฅุถุงูุฉ logging ูู `driver-view.html` ุฃู ุงุณุชุฎุฏุงู Chrome DevTools

---

### ูุดููุฉ #3: isActive ูุง ูุชุญุฏุซ ุนูุฏ ุฅููุงู ุงูุชุชุจุน
**ุงูุญุงูุฉ:** ููุฏ ุงูุงุฎุชุจุงุฑ  
**ุงูุณุจุจ ุงููุญุชูู:** ุฏุงูุฉ `stop()` ูู `LocationService.js` ูุฏ ูุง ุชุนูู ุจุดูู ุตุญูุญ  
**ุงูุญู ุงูููุชุฑุญ:** ุงุฎุชุจุงุฑ ุฏุงูุฉ `updateDriverStatus(false)` ุจุนุฏ ุฅุนุงุฏุฉ ุงูุจูุงุก

---

## ๐ซ ุงูุฃุฎุทุงุก ุงูุชู ูุฌุจ ุชุฌูุจูุง

### โ ุฎุทุฃ #1: ุงุณุชุฎุฏุงู ุฃุฑูุงู ุจุณูุทุฉ ููุนุฑูุงุช
**ูุซุงู ุฎุงุทุฆ:** `driverId = "1"`  
**ุงูุตุญูุญ:** `driverId = "DRV001"`

---

### โ ุฎุทุฃ #2: ุงููุฑุงุกุฉ ูู collection ุฎุงุทุฆ
**ูุซุงู ุฎุงุทุฆ:** `collection(db, 'driverLocations')`  
**ุงูุตุญูุญ:** `collection(db, 'drivers')`

---

### โ ุฎุทุฃ #3: ุงุณุชุฎุฏุงู ูุนุฑูุงุช ุซุงุจุชุฉ ูู ุงูููุฏ
**ูุซุงู ุฎุงุทุฆ:** `const testDriverId = 'DRV001';`  
**ุงูุตุญูุญ:** ูุฑุงุกุฉ `driverId` ูู AsyncStorage ุฃู URL parameter

---

### โ ุฎุทุฃ #4: ุนุฏู ุงุณุชุฎุฏุงู onSnapshot ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
**ูุซุงู ุฎุงุทุฆ:** `getDoc()` ุฃู `getDocs()`  
**ุงูุตุญูุญ:** `onSnapshot()` ููุงุณุชูุงุน ูู ุงูููุช ุงููุนูู

---

### โ ุฎุทุฃ #5: ูุณูุงู import ุนูุฏ ุงุณุชุฎุฏุงู ููููุงุช React Native
**ูุซุงู ุฎุงุทุฆ:** ุงุณุชุฎุฏุงู `Alert.alert()` ุจุฏูู `import { Alert } from 'react-native';`  
**ุงูุฎุทุฃ:** `Property 'Alert' doesn't exist`  
**ุงูุตุญูุญ:** ุฏุงุฆูุงู ุฃุถู imports ูู ุจุฏุงูุฉ ุงูููู ูุจู ุงุณุชุฎุฏุงู ุฃู ูููู

---

### โ ุฎุทุฃ #6: ุงุณุชุฎุฏุงู firestore ุจุฏูู ุฃููุงุณ ูุน FieldValue
**ูุซุงู ุฎุงุทุฆ:** `firestore.FieldValue.serverTimestamp()`  
**ุงูุฎุทุฃ:** `u.default.FieldValue.serverTimestamp is not a function (it is undefined)`  
**ุงูุณุจุจ:** `firestore` ูู ุฏุงูุฉ ูููุณ ูุงุฆูุ ูุฌุจ ุงุณุชุฏุนุงุคูุง ุฃููุงู  
**ุงูุตุญูุญ ูุธุฑูุงู:** `firestore().FieldValue.serverTimestamp()` (ูุงุญุธ ุงูุฃููุงุณ `()` ุจุนุฏ firestore)  
**ููุงุญุธุฉ:** ูู ุจุนุถ ุงูุฅุตุฏุงุฑุงุช (v23+)ุ ูุฏ ูุง ูุนูู `serverTimestamp()` ุจุณุจุจ ุชุถุงุฑุจุงุช. ุงุณุชุฎุฏู `new Date()` ูุจุฏูู.

---

### โ ุฎุทุฃ #7: ุงูุงุนุชูุงุฏ ุนูู serverTimestamp() ูู ุงูุฅุตุฏุงุฑุงุช ุงูุฌุฏูุฏุฉ
**ุงููุดููุฉ:** `Cannot read property 'serverTimestamp' of undefined`  
**ุงูุณุจุจ:** ุชุถุงุฑุจ ูุญุชูู ูุน React Native Firebase v23 ุฃู React 19  
**ุงูุญู ุงูุจุฏูู:** ุงุณุชุฎุฏู `new Date()` ุจุฏูุงู ูู `serverTimestamp()`  
**ูุซุงู:**
```javascript
// ุจุฏูุงู ูู
lastUpdate: firestore().FieldValue.serverTimestamp()

// ุงุณุชุฎุฏู
lastUpdate: new Date()
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุนู ุงูุชุชุจุน:
- ุงูุชุชุจุน ูุณุชุฎุฏู ููุชุจุฉ **Transistor Background Geolocation v4.19.0**
- ุงูุฅุตุฏุงุฑ 4.19.0 ูุฏุนู `play-services-location v21+`
- ุฅุนุฏุงุฏุงุช ุงูุชุชุจุน: `distanceFilter: 10` ูุชุฑุ `desiredAccuracy: HIGH`

### ุนู Firestore:
- ุงูููุงุนุฏ ุงูุญุงููุฉ: ุงูุณูุงุญ ููุฌููุน ุจุงููุฑุงุกุฉ ูุงููุชุงุจุฉ (ููุงุณุชุฎุฏุงู ุงููุญูู)
- Database location: `me-central1`
- **ููุงุญุธุฉ ูููุฉ:** ุงุณุชุฎุฏู `new Date()` ุจุฏูุงู ูู `serverTimestamp()` ูุชุฌูุจ ูุดุงูู ุงูุชูุงูู

### ุนู ุงูุชุถุงุฑุจุงุช ุงููุนุฑููุฉ:
- React Native Firebase v23.4.1 + React 19.1.1 ูุฏ ูุณุจุจ ูุดุงูู ูุน `serverTimestamp()`
- ุงูุญู: ุงุณุชุฎุฏุงู `new Date()` ูุจุฏูู ูุคูุช ุฃู ุฏุงุฆู

### ุนู Vercel:
- ุงููููุน: `https://test-taxi-knpc.vercel.app/`
- ูุชู ุงููุดุฑ ุชููุงุฆูุงู ุนูุฏ push ุฅูู `main` branch

---

## ๐ ููุงุท ุงูุชุญูู ูุจู ุฃู ุชุนุฏูู

ูุจู ุชุนุฏูู ุฃู ููุฏุ ุชุญูู ูู:

1. โ ูู ุงูุชุนุฏูู ูุชุนุงุฑุถ ูุน ุงูููุงุนุฏ ุงูุฐูุจูุฉุ
2. โ ูู ุงูุชุนุฏูู ูุคุซุฑ ุนูู ูุนุฑูุงุช ุงูุณุงุฆูููุ
3. โ ูู ุงูุชุนุฏูู ูุบูุฑ collection ุงููุณุชุฎุฏู ูู Firestoreุ
4. โ ูู ุงูุชุนุฏูู ูุณุชุฎุฏู `onSnapshot` ููุชุญุฏูุซุงุช ุงูููุฑูุฉุ
5. โ ูู ุงูุชุนุฏูู ููุซู ูู ุณุฌู ุงูุชุบููุฑุงุชุ

---

## ๐ ุญุงูุฉ ุงููุดุฑูุน ุงูุญุงููุฉ

### ุงูุชุทุจูู (TaxiDriverApp):
- โ Google Play Services: ูุญุฏูุซ ูุตุญูุญ
- โ๏ธ ุงูุชุชุจุน ุงูุชููุงุฆู: ููุฏ ุงูุงุฎุชุจุงุฑ
- โ ุงูุตูุญุฉ ุงูุชุฌุฑูุจูุฉ: ุชุนูู ุจุดูู ุตุญูุญ
- โ๏ธ ุตูุญุฉ ูุนูููุงุช ุงูุณุงุฆู: ูุงุฑุบุฉ

### ุงููููุน (Test-taxi):
- โ ุตูุญุงุช ุงูุชุชุจุน: ุชูุฑุฃ ูู `drivers` collection
- โ ุงูุงุณุชูุงุน ูู ุงูููุช ุงููุนูู: ููุนูู
- โ ุงุณุชุฎุฏุงู `isActive`: ุตุญูุญ
- โ๏ธ ุงูุจูุงูุงุช ุงููุฏููุฉ: `DRV001` ูุง ูุฒุงู `isActive: true` ูู ุฃูุณ

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. ุฅุนุงุฏุฉ ุจูุงุก ุงูุชุทุจูู ุนูู CodeMagic
2. ุงุฎุชุจุงุฑ ุงูุชุชุจุน ุงูุชููุงุฆู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
3. ุงุฎุชุจุงุฑ ุชุญุฏูุซ `isActive` ุนูุฏ ุฅููุงู ุงูุชุชุจุน
4. ุงุฎุชุจุงุฑ ุตูุญุฉ ูุนูููุงุช ุงูุณุงุฆู ูู WebView
5. ุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ ูู Firestore

---

**ููุงูุฉ ุงููุฑุฌุน ุงูุฑุฆูุณู**




---

## ๐ ุฏููู ุงูุตูุญุงุช ุงูุดุงูู

### ๐ ุงูุชุทุจูู (TaxiDriverApp)

---

#### 1. `LoginScreen.js`

**ุงููููุน:** `/src/screens/LoginScreen.js`

**ุงููุธููุฉ:** ุตูุญุฉ ุชุณุฌูู ุฏุฎูู ุงูุณุงุฆู

**ูุง ูุฏุฎูู ุงููุณุชุฎุฏู:**
- ุงุณู ุงููุณุชุฎุฏู (ูุซู: "ุณุงุฆู 1")
- ูููุฉ ุงููุฑูุฑ (ูุซู: "123")

**ูุง ุชูุฑุฃู:**
- **ูู:** `users` collection ูู Firestore
- **ุงูุทุฑููุฉ:** `getDocs()` ูุน query ููุจุญุซ ุนู ุงููุณุชุฎุฏู
- **ุงูุญููู ุงูููุฑูุกุฉ:**
  - `name` - ูููุทุงุจูุฉ ูุน ุงุณู ุงููุณุชุฎุฏู ุงููุฏุฎู
  - `password` - ููุชุญูู ูู ูููุฉ ุงููุฑูุฑ
  - `driverId` - ุงูุฑูู ุงููุธููู (ูุซู "DRV001")
  - `role` - ููุน ุงููุณุชุฎุฏู ("driver" ุฃู "admin")

**ูุง ุชูุชุจู:**
- **ุฅูู:** AsyncStorage (ุงูุชุฎุฒูู ุงููุญูู ูู ุงูุฌูุงุฒ)
- **ุงูุจูุงูุงุช ุงููุญููุธุฉ:**
  - `employeeNumber` = `driverId` (ูุซู "DRV001")
  - `driverName` = `name` (ูุซู "ุณุงุฆู 1")
  - `userRole` = `role` (ูุซู "driver")

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- ุงูุณุงุฆู **ูุง ููุชุจ** ุฑููู ุงููุธููู
- ุงูุฑูู ุงููุธููู ูููุฑุฃ ุชููุงุฆูุงู ูู Firestore ุจูุงุกู ุนูู ุงุณู ุงููุณุชุฎุฏู

---

#### 2. `MainScreen.js`

**ุงููููุน:** `/src/screens/MainScreen.js`

**ุงููุธููุฉ:** ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ ููุณุงุฆู - ุชุญุชูู ุนูู WebView ูุนุฑุถ ุตูุญุงุช ุงููููุน

**ูุง ุชูุฑุฃู:**
- **ูู:** AsyncStorage
- **ุงูุจูุงูุงุช ุงูููุฑูุกุฉ:**
  - `employeeNumber` - ุงูุฑูู ุงููุธููู (ูุซู "DRV001")
  - `driverName` - ุงุณู ุงูุณุงุฆู

**ูุง ุชูุชุจู:**
- **ูุง ุชูุชุจ** ุฅูู Firestore ูุจุงุดุฑุฉ
- ุชุณุชุฏุนู `LocationService.start()` ุงูุฐู ููุชุจ ุงูุจูุงูุงุช

**WebView URLs:**
- ุตูุญุฉ ูุนูููุงุช ุงูุณุงุฆู: `https://test-taxi-knpc.vercel.app/driver-view.html?driverId=${driverId}`
- ุชูุฑุฑ `driverId` ุนุจุฑ URL parameter ู sessionStorage

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- ุงูุชุชุจุน ุงูุชููุงุฆู ูุจุฏุฃ ูู `useEffect` ุนูุฏ ุชุญููู ุงูุตูุญุฉ
- ูุณุชุฏุนู `LocationService.start(driverId)` ูุน ุงูุฑูู ุงููุธููู

---

#### 3. `TestTrackingScreen.js`

**ุงููููุน:** `/src/screens/TestTrackingScreen.js`

**ุงููุธููุฉ:** ุตูุญุฉ ุชุฌุฑูุจูุฉ ูุงุฎุชุจุงุฑ ุงูุชุชุจุน ููุฑุงูุจุฉ ุญุงูุฉ ุงูุณุงุฆู

**ูุง ุชูุฑุฃู:**
- **ูู:** AsyncStorage
  - `employeeNumber` - ุงูุฑูู ุงููุธููู (ุฏููุงูููู)
- **ูู:** `drivers` collection ูู Firestore
  - **Document ID:** `employeeNumber` (ูุซู "DRV001")
  - **ุงูุทุฑููุฉ:** `onSnapshot()` - ุงุณุชูุงุน ูู ุงูููุช ุงููุนูู
  - **ุงูุญููู ุงูููุฑูุกุฉ:**
    - `isActive` - ุญุงูุฉ ุงูุชุชุจุน
    - `location` - ุงููููุน ุงูุญุงูู
    - `lastUpdate` - ุขุฎุฑ ุชุญุฏูุซ

**ูุง ุชูุชุจู:**
- **ูุง ุชูุชุจ** ุฅูู Firestore
- ุชุนุฑุถ ุงูุจูุงูุงุช ููุท

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- ูุง ุชุณุชุฎุฏู ูุนุฑู ุซุงุจุช - ุชูุฑุฃ ูู AsyncStorage
- ุชุณุชุฎุฏู `onSnapshot` ููุชุญุฏูุซุงุช ุงูููุฑูุฉ

---

#### 4. `LocationService.js`

**ุงููููุน:** `/src/services/LocationService.js`

**ุงููุธููุฉ:** ุฎุฏูุฉ ุงูุชุชุจุน - ุชุฏูุฑ ุชุชุจุน ูููุน ุงูุณุงุฆู ูู ุงูุฎูููุฉ

**ูุง ุชูุฑุฃู:**
- **ูุง ุชูุฑุฃ** ูู Firestore
- ุชุณุชูุจู `driverId` ููุนุงูู ุนูุฏ ุงุณุชุฏุนุงุก `start(driverId)`

**ูุง ุชูุชุจู:**
- **ุฅูู:** `drivers` collection ูู Firestore
- **Document ID:** `driverId` (ูุซู "DRV001")
- **ุงูุทุฑููุฉ:** `set()` ูุน `{ merge: true }`
- **ุงูุจูุงูุงุช ุงูููุชูุจุฉ:**

**ุนูุฏ ุจุฏุก ุงูุชุชุจุน (`start()`):**
```javascript
{
  driverId: "DRV001",
  isActive: true,
  lastUpdate: serverTimestamp()
}
```

**ุนูุฏ ุชุญุฏูุซ ุงููููุน (ูู 10 ูุชุฑ):**
```javascript
{
  location: {
    latitude: number,
    longitude: number,
    speed: number,
    accuracy: number,
    heading: number
  },
  lastUpdate: serverTimestamp()
}
```

**ุนูุฏ ุฅููุงู ุงูุชุชุจุน (`stop()`):**
```javascript
{
  isActive: false,
  lastUpdate: serverTimestamp()
}
```

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- ูุณุชุฎุฏู `BackgroundGeolocation` ูู ููุชุจุฉ Transistor
- `distanceFilter: 10` - ูุฑุณู ุชุญุฏูุซ ูู 10 ูุชุฑ
- ููุชุจ ุฅูู Firestore ูุจุงุดุฑุฉ ุจุฏูู middleware

---

### ๐ ุงููููุน (Test-taxi ุนูู Vercel)

---

#### 5. `driver-view.html`

**ุงููููุน:** `https://test-taxi-knpc.vercel.app/driver-view.html`

**ุงููุธููุฉ:** ุตูุญุฉ ูุนูููุงุช ุงูุณุงุฆู - ุชุนุฑุถ ุชูุงุตูู ุงูุณุงุฆู ุงูุดุฎุตูุฉ ูุงููุงููุฉ

**ูุง ุชูุฑุฃู:**
- **ูู:** URL parameter `?driverId=DRV001`
- **ูู:** sessionStorage (ูุชู ุญููู ูู WebView)
- **ูู:** `drivers` collection ูู Firestore
  - **Document ID:** `driverId` (ูุซู "DRV001")
  - **ุงูุทุฑููุฉ:** `onSnapshot()` - ุงุณุชูุงุน ูู ุงูููุช ุงููุนูู
  - **ุงูุญููู ุงูููุฑูุกุฉ:**
    - `name` - ุงุณู ุงูุณุงุฆู
    - `phone` - ุฑูู ุงููุงุชู
    - `employeeNumber` - ุงูุฑูู ุงููุธููู
    - `nationality` - ุงูุฌูุณูุฉ
    - `address` - ุงูุนููุงู
    - `assignedCar` - ุงูุณูุงุฑุฉ ุงููุฎุตุตุฉ
    - `isActive` - ุญุงูุฉ ุงูุชุชุจุน
    - `location` - ุงููููุน ุงูุญุงูู

**ูุง ุชูุชุจู:**
- **ูุง ุชูุชุจ** ุฅูู Firestore
- ุชุนุฑุถ ุงูุจูุงูุงุช ููุท

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- ุชุณุชูุจู `driverId` ูู WebView ุนุจุฑ URL parameter
- ุชุณุชุฎุฏู `onSnapshot` ููุชุญุฏูุซุงุช ุงูููุฑูุฉ

---

#### 6. `test-tracking.html`

**ุงููููุน:** `https://test-taxi-knpc.vercel.app/test-tracking.html`

**ุงููุธููุฉ:** ุตูุญุฉ ุชุชุจุน ุชุฌุฑูุจูุฉ - ุชุนุฑุถ ูููุน ุณุงุฆู ูุงุญุฏ ุนูู ุงูุฎุฑูุทุฉ

**ูุง ุชูุฑุฃู:**
- **ูู:** URL parameter `?driverId=DRV001`
- **ูู:** `drivers` collection ูู Firestore
  - **Document ID:** `driverId` ูู URL (ูุซู "DRV001")
  - **ุงูุทุฑููุฉ:** `onSnapshot()` - ุงุณุชูุงุน ูู ุงูููุช ุงููุนูู
  - **ุงูุญููู ุงูููุฑูุกุฉ:**
    - `isActive` - ุญุงูุฉ ุงูุชุชุจุน
    - `location.latitude` - ุฎุท ุงูุนุฑุถ
    - `location.longitude` - ุฎุท ุงูุทูู
    - `location.speed` - ุงูุณุฑุนุฉ
    - `location.accuracy` - ุงูุฏูุฉ
    - `lastUpdate` - ุขุฎุฑ ุชุญุฏูุซ

**ูุง ุชูุชุจู:**
- **ูุง ุชูุชุจ** ุฅูู Firestore
- ุชุนุฑุถ ุงูุจูุงูุงุช ููุท

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- ูุฌุจ ุชูุฑูุฑ `driverId` ูู URL: `test-tracking.html?driverId=DRV001`
- ุฅุฐุง ูู ูุชู ุชูุฑูุฑ `driverId`ุ ุชุณุชุฎุฏู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ (ูุฏ ุชููู ุฎุงุทุฆุฉ)

---

#### 7. `tracking.html`

**ุงููููุน:** `https://test-taxi-knpc.vercel.app/tracking.html`

**ุงููุธููุฉ:** ุตูุญุฉ ุงูุชุชุจุน ุงูุฑุฆูุณูุฉ - ุชุนุฑุถ ุฌููุน ุงูุณุงุฆููู ุงููุดุทูู ุนูู ุงูุฎุฑูุทุฉ

**ูุง ุชูุฑุฃู:**
- **ูู:** `drivers` collection ูู Firestore
  - **ุฌููุน ุงููุซุงุฆู** ูู collection
  - **ุงูุทุฑููุฉ:** `onSnapshot()` - ุงุณุชูุงุน ูู ุงูููุช ุงููุนูู
  - **ุงูุญููู ุงูููุฑูุกุฉ:**
    - `isActive` - ุญุงูุฉ ุงูุชุชุจุน
    - `location.latitude` - ุฎุท ุงูุนุฑุถ
    - `location.longitude` - ุฎุท ุงูุทูู
    - `location.speed` - ุงูุณุฑุนุฉ
    - `location.accuracy` - ุงูุฏูุฉ
    - `lastUpdate` - ุขุฎุฑ ุชุญุฏูุซ

**ูุง ุชูุชุจู:**
- **ูุง ุชูุชุจ** ุฅูู Firestore
- ุชุนุฑุถ ุงูุจูุงูุงุช ููุท

**ููู ุชุนุฑุถ ุงูุณุงุฆููู:**
- ุชูุฑุฃ **ุฌููุน** ุงูุณุงุฆููู ูู `drivers` collection
- ุชุนุฑุถ ููุท ุงูุณุงุฆููู ุงูุฐูู ูุฏููู `location` ุตุงูุญ
- ุชุณุชุฎุฏู `isActive` ูุชุญุฏูุฏ ุญุงูุฉ ุงูุณุงุฆู (ูุดุท/ุบูุฑ ูุดุท)

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- **ูุง ุชุณุชุฎุฏู** `driverLocations` collection (ูุฏูู ููููู)
- **ูุฌุจ** ุงุณุชุฎุฏุงู `drivers` collection ููุท
- ุชุนุฑุถ ุงูุณุงุฆู ุญุชู ูู ูุงู `isActive: false` (ููู ุจุญุงูุฉ "ุบูุฑ ูุดุท")

---

#### 8. `tracking-management.html`

**ุงููููุน:** `https://test-taxi-knpc.vercel.app/tracking-management.html`

**ุงููุธููุฉ:** ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุชุชุจุน - ุชุนุฑุถ ูุงุฆูุฉ ุจุฌููุน ุงูุณุงุฆููู ูุน ุชูุงุตูู ุญุงูุชูู

**ูุง ุชูุฑุฃู:**
- **ูู:** `drivers` collection ูู Firestore
  - **ุฌููุน ุงููุซุงุฆู** ูู collection
  - **ุงูุทุฑููุฉ:** `onSnapshot()` - ุงุณุชูุงุน ูู ุงูููุช ุงููุนูู
  - **ุงูุญููู ุงูููุฑูุกุฉ:**
    - `driverId` - ุงูุฑูู ุงููุธููู
    - `name` - ุงุณู ุงูุณุงุฆู
    - `isActive` - ุญุงูุฉ ุงูุชุชุจุน
    - `location` - ุงููููุน ุงูุญุงูู
    - `lastUpdate` - ุขุฎุฑ ุชุญุฏูุซ

**ูุง ุชูุชุจู:**
- **ูุง ุชูุชุจ** ุฅูู Firestore
- ุชุนุฑุถ ุงูุจูุงูุงุช ููุท

**ููู ุชุนุฑุถ ุงูุณุงุฆููู:**
- ุชูุฑุฃ **ุฌููุน** ุงูุณุงุฆููู ูู `drivers` collection
- ุชุนุฑุถ ูุงุฆูุฉ ุจุงูุณุงุฆููู ูุน ุญุงูุชูู (ูุดุท/ุบูุฑ ูุดุท)
- ุชุณุชุฎุฏู `isActive` ูู Firestore ูุจุงุดุฑุฉ

**โ๏ธ ููุงุญุธุฉ ูููุฉ:**
- **ูุง ุชุญุณุจ** `isActive` ุจูุงุกู ุนูู ุงูููุช
- **ูุฌุจ** ุงุณุชุฎุฏุงู `isActive` ูู Firestore ูุจุงุดุฑุฉ
- **ูุง ุชุณุชุฎุฏู** `driverLocations` collection

---

## ๐ ูุฎุทุท ุชุฏูู ุงูุจูุงูุงุช

### ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
```
1. ุงูุณุงุฆู ูุฏุฎู ุงุณูู ููููุฉ ุงููุฑูุฑ ูู LoginScreen
2. LoginScreen ููุฑุฃ ูู users collection
3. LoginScreen ูุญูุธ driverId ูู AsyncStorage
4. ุงูุงูุชูุงู ุฅูู MainScreen
```

### ุนูุฏ ุจุฏุก ุงูุชุชุจุน:
```
1. MainScreen ููุฑุฃ driverId ูู AsyncStorage
2. MainScreen ูุณุชุฏุนู LocationService.start(driverId)
3. LocationService ููุชุจ ุฅูู drivers/{driverId}:
   - isActive: true
   - lastUpdate: timestamp
4. LocationService ูุจุฏุฃ ุชุชุจุน ุงููููุน
5. ูู 10 ูุชุฑุ LocationService ููุชุจ location ุฅูู drivers/{driverId}
```

### ุนูุฏ ุนุฑุถ ุงูุชุชุจุน ูู ุงููููุน:
```
1. tracking.html ููุฑุฃ ูู drivers collection (ุฌููุน ุงูุณุงุฆููู)
2. onSnapshot ูุณุชูุน ููุชุญุฏูุซุงุช ูู ุงูููุช ุงููุนูู
3. ุนูุฏ ุชุญุฏูุซ locationุ ุชุชุญุฏุซ ุงูุฎุฑูุทุฉ ุชููุงุฆูุงู
4. ูุนุฑุถ ุงูุณุงุฆู ูู "ูุดุท" ุฅุฐุง ูุงู isActive: true
```

### ุนูุฏ ุฅููุงู ุงูุชุชุจุน:
```
1. ุงูุณุงุฆู ูุถุบุท ุนูู "ุฅููุงู ุงูุชุชุจุน" ูู MainScreen
2. MainScreen ูุณุชุฏุนู LocationService.stop()
3. LocationService ููุชุจ ุฅูู drivers/{driverId}:
   - isActive: false
   - lastUpdate: timestamp
4. LocationService ูููู ุชุชุจุน ุงููููุน
5. ุตูุญุงุช ุงููููุน ุชุชุญุฏุซ ุชููุงุฆูุงู ูุชุนุฑุถ ุงูุณุงุฆู ูู "ุบูุฑ ูุดุท"
```

---

## ๐ ููุงุท ุงูุชุญูู ููู ุตูุญุฉ

### ูุจู ุชุนุฏูู ุฃู ุตูุญุฉ:

**ููุตูุญุงุช ูู ุงูุชุทุจูู:**
1. โ ูู ุชูุฑุฃ `driverId` ูู AsyncStorage (ูููุณ ูููุฉ ุซุงุจุชุฉ)ุ
2. โ ูู ุชูุชุจ ุฅูู `drivers/{driverId}` (ูููุณ collection ุขุฎุฑ)ุ
3. โ ูู ุชุณุชุฎุฏู `onSnapshot` ููุชุญุฏูุซุงุช ุงูููุฑูุฉุ

**ููุตูุญุงุช ูู ุงููููุน:**
1. โ ูู ุชูุฑุฃ ูู `drivers` collection (ูููุณ `driverLocations`)ุ
2. โ ูู ุชุณุชุฎุฏู `onSnapshot` (ูููุณ `getDoc` ุฃู `getDocs`)ุ
3. โ ูู ุชุณุชุฎุฏู `isActive` ูู Firestore (ูููุณ ุญุณุงุจ ุงูููุช)ุ
4. โ ูู ุชูุฑุฃ `driverId` ูู URL parameter (ููุตูุญุงุช ุงููุฑุฏูุฉ)ุ

---

**ููุงูุฉ ุฏููู ุงูุตูุญุงุช ุงูุดุงูู**

